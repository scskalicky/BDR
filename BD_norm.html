<!DOCTYPE html>
<html>
  <head>
  <title>...</title>
  <script type = "text/javascript" src="jquery-3.6.0.js"></script>
  <script src = "jspsych/jspsych.js"></script>
  <script src = 'jspsych/plugin-fullscreen.js'></script>
  <script src = "jspsych/plugin-html-keyboard-response.js"></script>
  <script src = "jspsych/plugin-html-button-response.js"></script>
  <script src = "jspsych/plugin-instructions.js"></script>
  <script src = "jspsych/plugin-survey-text.js"></script>
  <script src = "jspsych/plugin-survey-likert.js"></script>
  <script src = "jspsych/plugin-survey-html-form.js"></script>
  <script src = "jspsych/plugin-survey-multi-choice.js"></script>
  <script src = "jspsych/plugin-browser-check3.js"></script>
  <script src = "jspsych/plugin-survey.js"></script>
  <script src = "jspsych/plugin-cloze19.js"></script>
  <script src="jspsych/plugin-preload.js"></script>
  <script src="lextale.js"></script>
  <script src='demographic_survey.js'></script>
  <script src='listA_stimuli_ND.js'></script>
  <script src='listB_stimuli_ND.js'></script>
  <script src='practice_stimuli.js'></script>
  <script src = 'helper_functions1.js'></script>
  <script src = 'info_sheet.js'></script>

  <link href = "jspsych/jspsych.css" rel="stylesheet" type = "text/css" />

  </head>
  <body></body>  
  <script>

  const jsPsych = initJsPsych({
    show_progress_bar: true,
    message_progress_bar: '<span style = "color:red";><b>DO NOT REFRESH YOUR BROWSER OR HIT BACK!<span></b>',
    on_finish: function(data){
      // calculate lextale and append to data.
      var lextale_score = ((rw_score / 40*100) + (nw_score / 20 * 100))  / 2;
		  jsPsych.data.addProperties({lextale_score: lextale_score});
        
        //   jsPsych.data.displayData();

      // forward to thank you message.
       window.location = 'https://figuratively-speaking.com/BDR/thankyou.html'
    },
  });
  </script>


<script>
// init timeline
var timeline = [];


irony_stim = stimuli_a_ND


const browser_check = {
  type: jsPsychBrowserCheck,
  // returns whether the mobile is equal to false
  inclusion_function: (data) => {
    return data.mobile === false
  },
  // i changed the plugin itself--dangerous!
  // i don't think this will even fire now but this is a required argument for this trial type. 
  exclusion_message: (data) => {
    if(data.mobile){
      return '<p>You must use a desktop/laptop computer to participate in this experiment.</p>';
    }
  }
};

const information_sheet = {
		type: jsPsychHtmlButtonResponse,
		stimulus: info_sheet,
		prompt: '<br><br>',
		choices: ['Continue'],
		required: true,
		on_finish: function(data){
			data.trial_item = 'info_sheet';}
	};

	const consent = {
		type: jsPsychHtmlButtonResponse,
		stimulus: consent_sheet,
		choices: ["I AGREE"],
		prompt: '<br><br>',
		required: true,
		on_finish: function(data){
			data.trial_item = 'consent';}
	};

var enter_fullscreen = {
  type: jsPsychFullscreen,
  fullscreen_mode: true,
  message: '<p class = "instructions" style = "font-size: 30px; color: red"><b>ATTENTION PLEASE!</b></p><p class = "instructions">We ask that you provide your fullest attention during the experiment. Please turn off your phone as well as any music, television, or other potential distractions around you. <br><br> Your browser will now switch to full screen mode. Please leave your browser in full screen for the duration of the test.</p><br>'
};

const norming_instructions01 = {
    on_start: function(){
        // stupid function to pick the stimuli lists. 
        var coin = Math.random(1);
        jsPsych.data.addProperties({stim_list: 'A'})
        console.log(jsPsych.data.get())
        if(coin <=.5){
            irony_stim = stimuli_b_ND
            console.log('coin toss lost, switching to b')
            jsPsych.data.addProperties({stim_list: 'B'})
            console.log(jsPsych.data.get())
        };

    },
  type: jsPsychHtmlButtonResponse,
    stimulus: '<p class = "instructions">Thank you for participating in this study!</p><p class = "instructions" style = "font-size: 30px; color: red"><b>STOP!</b></p><p class = "instructions">You should set aside about 30-45 minutes to complete this experiment. This experiment should be completed in one go - you cannot save your data and return later. In this experiment, you will complete three tasks: a demographic survey, a sentence ratings activity, and a word recognition activity.<br><br>During the experiment, please <b><span style = "color:red;">do not</b><span> refresh your browser or use the back button. Doing so will result in a loss of all your data, and you will be unable to continue.<br><br>Finally, please be sure to take this test on a computer in a quiet room. Do not use a mobile device such as a phone or tablet.</p><br>',
    choices: ['I Understand']
}

const norming_instructions02 = {
    type: jsPsychHtmlButtonResponse,
    stimulus: '<p class = "instructions">Your will now read through a series of different stories. Each story will end with a target sentence. Your goal is to rate how ironic the target sentence is using a scale which ranges from not ironic to very ironic. When you make your decision, be sure to consider the statement in the context of the entire story.</p><br>',
    choices: ['I Understand']
}

const norming_instructions03 = {
    type: jsPsychHtmlButtonResponse,
    stimulus: '<p style = "font-size:20px; text-align:center">You are now ready to begin. You will read a total of <b>48</b> stories. </p><br>',
    choices: ['I\'m Ready!']
}

var story_counter = 1

const irony_rating_trials = {
    timeline: [
    {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Press the SPACEBAR to see the next story.<br><br>',
    choices: [' '],
},
{

type: jsPsychHtmlButtonResponse,
on_start: function(trial){
  trial.stimulus = '<p style = "font-size:20px; text-align:center; width:800px">'.concat(jsPsych.timelineVariable('s1'), ' ', jsPsych.timelineVariable('s2'),'<br><br>   ', jsPsych.timelineVariable('s3'),'<br>','<i>\"',jsPsych.timelineVariable('t1'), ' ', jsPsych.timelineVariable('t2'), ' ', jsPsych.timelineVariable('t3'),"</i>\"<br><br>");
    trial.prompt = '<br>How ironic is the final sentence?<br><br><p style = "font-size:14px"<i>'.concat(String(story_counter)).concat('/48 stories completed</i>');
},
  prompt: "",
  stimulus: '',
  data: jsPsych.timelineVariable('data'),
  // the resulting values are 0,1,2,3
  choices: ['Not Ironic', 'Slightly Ironic', 'Moderately Ironic', 'Very Ironic'],
  on_finish: function(data){
      console.log(data.response);
      story_counter++;
    }
}
], timeline_variables: irony_stim, randomize_order: true

}


const end_experiment = {
  type: jsPsychHtmlButtonResponse,
  stimulus: '<p class = "instructions">You have completed the experiment, thank you. Please press Continue.</p>',
  on_start: function(){
    // save data
    console.log(jsPsych.data.get().select('subject').values[0])
    //jsPsych.data.get().select('email').values[0]
    saveData(jsPsych.data.get().select('subject').values[0],jsPsych.data.get().select('email').values[0],jsPsych.data.get().csv());
  },
  choices: ["Continue"]
}


const demographic_timeline = [instructions_demo, 
name, 
age, 
sex,
education_level, 
country_background, 
language_background, 
english_outside_classroom, 
years_learning_english, 
english_activities, 
self_ratings_english
]
const lextale_timeline = [lextale_preamble, instructions_lextale, pre_lextale, lextale]


// use spread operator (...) to push the arrays
timeline.push(
    browser_check,
    information_sheet, 
    consent,
    enter_fullscreen,
    norming_instructions01,
    ...demographic_timeline,
   
    norming_instructions02,
    norming_instructions03,
    irony_rating_trials,
    ...lextale_timeline,
    end_experiment
);
 



jsPsych.run(timeline);

</script>